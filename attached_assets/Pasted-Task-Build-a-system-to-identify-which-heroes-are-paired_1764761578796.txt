Task: Build a system to identify which heroes are paired together in DeFi Kingdoms gardening expeditions and determine which hero farms CRYSTAL vs JEWEL.


Context:


I have 24 heroes across 4 LP pools (JEWEL-USDC, CRYSTAL-USDC, JEWEL-ETH, CRYSTAL-JEWEL) 
 
 
 
- 6 heroes per pool, 12 total expeditions
Each expedition has 2 heroes: one farms CRYSTAL, one farms JEWEL
Hero states are stored individually on-chain with no encoded pairing data 
Each hero has: quest contract address (0x0103...), 256-bit state integer, timestamps, and escrowed JEWEL amounts 

Pairing Logic:

Heroes belong to the same expedition if they have:


Same token pair (e.g., "JEWEL-USDC", "CRYSTAL-JEWEL") 
 
 
 
2. Same iteration time (e.g., "11:50:25" or "11:52:30") 
 
 
 
3. Nearly identical "Claimed Through" timestamps - within 60 seconds of each other (heroes started together in same transaction or close timing) 
 
 
 
4. Same "Expedition Complete At" timestamp 
 
 
 
Reward Token Identification:
To determine which hero gets CRYSTAL vs JEWEL:
Query each hero's previous quest completion history from the blockchain
Check the last reward token received (CRYSTAL or JEWEL contract address in transfer events)
The pattern persists: if hero A got CRYSTAL last time, they'll get CRYSTAL this iteration
If no history exists, prompt user for manual specification or implement fallback logic (e.g., odd/even hero ID)

Implementation Requirements:


Parse expedition data from API/UI showing token pairs, timestamps, and iteration times 
 
 
 
2. Group heroes by matching the 4 pairing criteria above
Validate each group has exactly 2 heroes (error if not)
For each pair, query blockchain for previous reward history
Output: {expedition_id: {hero1: {id, reward_token: "CRYSTAL"}, hero2: {id, reward_token: "JEWEL"}}}

Edge Cases:


Handle heroes with no reward history (new to expeditions)
Detect if timestamps differ by >60 seconds (potential mis-pairing)
Flag expeditions with â‰ 2 heroes per group

Please implement timestamp-based auto-pairing with reward history tracking to identify CRYSTAL vs JEWEL farmers per expedition.