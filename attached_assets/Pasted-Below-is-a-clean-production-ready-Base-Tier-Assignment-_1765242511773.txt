Below is a **clean, production-ready Base Tier Assignment Formula** for your DFK League System.

This formula:

* Uses **the KPIs you already track**
* Is **objective**, **transparent**, and **anti-smurf resilient**
* Fits neatly into your backend classification engine
* Produces **COMMON â†’ MYTHIC tiers**
* Automatically adjusts for **wallet power, activity, account age**, and **behavior health**

This is the formula Replit (backend) should implement inside your **TierService**.

---

# ğŸ§  **Base Tier Assignment Formula (v1.0)**

**Input:** `clusterKey` (aggregated across all wallets for that user)
**Output:** `TierCode = COMMON | UNCOMMON | RARE | LEGENDARY | MYTHIC`

We compute a **Composite Power Score (CPS)** from 5 components:

---

# ğŸ“Š 1ï¸âƒ£ Component A â€” **Hero Power Score (HPS)**

Weighted measure of heroes owned.

**HPS =**

```
(1 Ã— Common heroes)
+ (2 Ã— Uncommon heroes)
+ (4 Ã— Rare heroes)
+ (8 Ã— Legendary heroes)
+ (12 Ã— Mythic heroes)
+ (0.1 Ã— total hero levels)
```

**Caps & notes:**

* You count ALL linked wallets in the userâ€™s cluster.
* This prevents smurfing via splitting heroes across wallets.

---

# ğŸ’° 2ï¸âƒ£ Component B â€” **Wallet Value Score (WVS)**

Based on JEWEL-equivalent net worth (tokens + LP + staked positions).

Formula:

```
WVS = log10(1 + total_networth_usd)
```

This compresses whales without flattening small players.

**Examples:**

* $50 â†’ WVS â‰ˆ 1.7
* $500 â†’ WVS â‰ˆ 2.7
* $5,000 â†’ WVS â‰ˆ 3.7
* $50,000 â†’ WVS â‰ˆ 4.7

---

# âš™ï¸ 3ï¸âƒ£ Component C â€” **Activity Score (AS)**

Based on recent (last 30d) engagement:

```
AS =
  (0.03 Ã— total profession quests 30d)
+ (0.1 Ã— summons 30d)
+ (0.02 Ã— stamina utilization rate Ã— 100)
+ (0.5 Ã— days_active_last_30d)
```

Notes:

* Active players climb out of Common/Uncommon easily.
* Summoners are rewarded since they demonstrate deeper gameplay.

---

# ğŸ§¬ 4ï¸âƒ£ Component D â€” **Account Age Score (AAS)**

Protects newbies from being forced into high tiers.

```
AAS =
  if age_days < 30: 0
  if 30 â‰¤ age_days < 90: 1
  if 90 â‰¤ age_days < 180: 2
  if 180 â‰¤ age_days < 365: 3
  if age_days â‰¥ 365: 4
```

(You may use first seen chain activity, first hero minted, or first quest timestamp.)

---

# ğŸ›¡ï¸ 5ï¸âƒ£ Component E â€” **Behavior Health Score (BHS)**

Anti-extractor metric based on reinvestment + selling patterns.

```
BHS =
  2 Ã— reinvest_ratio_30d
+ 1 Ã— positive_delta_heroes
- 2 Ã— heavy_sell_activity
```

Where:

* `reinvest_ratio_30d` âˆˆ [0,1]
* `positive_delta_heroes` = net hero acquisitions (not transfers)
* `heavy_sell_activity` = 1 if high outflow â†’ prevents extractors from reaching higher tiers

**Range:** approx âˆ’2 to +3.

---

# ğŸ§® â­ **Composite Power Score (CPS)**

The weighted combination:

```
CPS =
  (0.40 Ã— HPS_normalized)
+ (0.25 Ã— WVS_normalized)
+ (0.20 Ã— AS_normalized)
+ (0.10 Ã— AAS_normalized)
+ (0.05 Ã— BHS_normalized)
```

Each component is normalized to **0â€“100** internally.

This weighting gives:

* **Heroes** â†’ biggest factor
* **Wallet value** & **activity** â†’ strong factors
* **Account age & behavior** â†’ modifiers, not core drivers

---

# ğŸ§© Normalization (backend implementation detail)

A simple approach:

### **HPS_normalized:**

```
min(100, (HPS / 2500) * 100)
```

### **WVS_normalized:**

```
min(100, (WVS / 5.0) * 100)
```

### **AS_normalized:**

```
min(100, (AS / 300) * 100)
```

### **AAS_normalized:**

```
(AAS / 4) * 100
```

### **BHS_normalized:**

Map from approx. range âˆ’2 to +3 into 0â€“100:

```
((BHS + 2) / 5) * 100
```

---

# ğŸ¯ **Final Tier Mapping (CPS â†’ TierCode)**

```
if CPS < 20:      tier = "COMMON"
else if CPS < 40: tier = "UNCOMMON"
else if CPS < 60: tier = "RARE"
else if CPS < 80: tier = "LEGENDARY"
else:             tier = "MYTHIC"
```

Why these thresholds?

* **Low CPS** â†’ new player or very low activity
* **Uncommon** â†’ early growth
* **Rare** â†’ engaged players with moderate power
* **Legendary** â†’ strong mid-game
* **Mythic** â†’ whales, OGs, multi-year vets, heavy summoners

  * Very hard to smurf your way out of this tier

---

# ğŸ”¥ Anti-Smurf Resistance Built Into the Formula

### âœ” Uses **clusterKey** â†’ cannot split power across wallets

### âœ” Wallet age protects newbies

### âœ” Extractors are blocked from high tiers

### âœ” Summoning-heavy OGs are naturally detected

### âœ” Hero rarity weighting is exponential

### âœ” Net worth log compression prevents single-token spikes

### âœ” 30d activity gives real behavior signals

Even if an OG moves a few heroes to a smurf:

* **HPS skyrockets**
* **WVS increases**
* CPS exceeds tier boundaries
  â†’ They get escalated to Legendary/Mythic instantly.

Perfect.

---

# ğŸ§© Now, to integrate it into backend:

Tell Replit:

> â€œImplement `TierService.computeBaseTier(clusterKey)` using the Base Tier Assignment Formula from `leagues.ts formulas`. Use all linked wallets in the cluster and lifetime/30d metrics aggregated from the Challenge Engine.â€

And I can generate that file for you too.

---

# ğŸš€ Want the **ready-to-drop-in TypeScript version of TierService.computeBaseTier()** matching this formula?
